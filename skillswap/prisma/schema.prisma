generator client {
  provider = "prisma-client"
  output   = "../lib/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  user_ID       String         @id @default(cuid())
  fullName      String
  email         String         @unique
  password      String
  city          String
  country       String
  phoneNumber   PhoneNumber[]
  bio           String         @db.Text
  role          Role           @default(STUDENT)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  admin         Admin[]
  student       Student[]
  refreshTokens RefreshToken[]
}

model PhoneNumber {
  phone_ID Int    @id @default(autoincrement())
  number   String
  user_ID  String
  user     User   @relation(fields: [user_ID], references: [user_ID], onDelete: Cascade)
}

enum Role {
  ADMIN
  STUDENT
}

model Admin {
  admin_ID String   @id
  user     User     @relation(fields: [admin_ID], references: [user_ID], onDelete: Cascade)
  reports  Report[]
}

model Student {
  student_ID      String          @id
  user            User            @relation(fields: [student_ID], references: [user_ID], onDelete: Cascade)
  experienceLevel ExperienceLevel
  availability    Availability
  isProfilePublic Boolean         @default(true)
  skillsCompleted Int             @default(0)
  skillOffered    SkillOffered[]
  skillWanted     SkillWanted[]

  requestSent     Request[]  @relation("RequestSent")
  requestReceived Request[]  @relation("RequestReceived")
  favorites       Favorite[] @relation("Favorites")
  favorited       Favorite[] @relation("Favorited")
  reports         Report[]   @relation("Reporter")
  reported        Report[]   @relation("Reported")
}

enum Availability {
  Morning
  Afternoon
  Evening
}

enum ExperienceLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model Skill {
  skill_ID     String         @id @default(cuid())
  name         String
  category     String?
  skillOffered SkillOffered[]
  skillWanted  SkillWanted[]
}

model SkillOffered {
  skillOffered_ID String    @id @default(cuid())
  student_ID      String
  skill_ID        String
  student         Student   @relation(fields: [student_ID], references: [student_ID], onDelete: Cascade)
  skill           Skill     @relation(fields: [skill_ID], references: [skill_ID], onDelete: Cascade)
  requests        Request[]
}

model SkillWanted {
  skillWanted_ID String    @id @default(cuid())
  student_ID     String
  skill_ID       String
  student        Student   @relation(fields: [student_ID], references: [student_ID], onDelete: Cascade)
  skill          Skill     @relation(fields: [skill_ID], references: [skill_ID], onDelete: Cascade)
  requests       Request[]
}

model Request {
  request_ID        String @id @default(cuid())
  sender_ID         String
  receiver_ID       String
  requestedSkill_ID String
  offeredSkill_ID   String

  sender         Student       @relation("RequestSent", fields: [sender_ID], references: [student_ID], onDelete: Cascade)
  receiver       Student       @relation("RequestReceived", fields: [receiver_ID], references: [student_ID])
  requestedSkill SkillOffered  @relation(fields: [requestedSkill_ID], references: [skillOffered_ID])
  offeredSkill   SkillWanted   @relation(fields: [offeredSkill_ID], references: [skillWanted_ID])
  status         RequestStatus @default(PENDING)
  createdAt      DateTime      @default(now())
  completedAt    DateTime?

  @@unique([sender_ID, receiver_ID, requestedSkill_ID, offeredSkill_ID])
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

model Favorite {
  favorite_ID   String @id @default(cuid())
  student_ID    String
  favStudent_ID String

  student    Student  @relation("Favorites", fields: [student_ID], references: [student_ID], onDelete: Cascade)
  favStudent Student  @relation("Favorited", fields: [favStudent_ID], references: [student_ID])
  createdAt  DateTime @default(now())
}

model Report {
  report_ID       Int     @id @default(autoincrement())
  reporter_ID     String
  reportedUser_ID String
  admin_ID        String
  reason          String
  adminNotes      String?

  reporter     Student  @relation("Reporter", fields: [reporter_ID], references: [student_ID])
  reportedUser Student  @relation("Reported", fields: [reportedUser_ID], references: [student_ID])
  admin        Admin    @relation(fields: [admin_ID], references: [admin_ID])
  createdAt    DateTime @default(now())

  @@index([reporter_ID])
  @@index([reportedUser_ID])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  user_ID   String
  user      User     @relation(fields: [user_ID], references: [user_ID], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Contact {
  contact_ID Int      @id @default(autoincrement())
  name       String
  email      String
  message    String   @db.Text
  createdAt  DateTime @default(now())
}
