generator client {
  provider = "prisma-client"
  output   = "../lib/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id          String        @id @default(cuid())
  fullName    String
  email       String        @unique
  password    String
  city        String
  state       String
  phoneNumber PhoneNumber[]
  bio         String        @db.Text
  role        Role
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  admin       Admin[]
  student     Student[]
}

model PhoneNumber {
  id     Int    @id @default(autoincrement())
  number String
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  ADMIN
  STUDENT
}

model Admin {
  adminId String @id
  user    User   @relation(fields: [adminId], references: [id], onDelete: Cascade)
}

model Student {
  studentId       String          @id
  user            User            @relation(fields: [studentId], references: [id], onDelete: Cascade)
  experienceLevel ExperienceLevel
  isProfilePublic Boolean         @default(true)
  skillsCompleted Int             @default(0)
  skillOffered    SkillOffered[]
  skillWanted     SkillWanted[]

  requestSent     Request[]  @relation("RequestSent")
  requestReceived Request[]  @relation("RequestReceived")
  favorites       Favorite[] @relation("Favorites")
  favorited       Favorite[] @relation("Favorited")
  reports         Report[]   @relation("Reporter")
  reported        Report[]   @relation("Reported")
}

enum ExperienceLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model Skill {
  id           String         @id @default(cuid())
  name         String
  category     String?
  skillOffered SkillOffered[]
  skillWanted  SkillWanted[]
}

model SkillOffered {
  id        String    @id @default(cuid())
  studentId String
  skillId   String
  student   Student   @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
  skill     Skill     @relation(fields: [skillId], references: [id], onDelete: Cascade)
  requests  Request[]
}

model SkillWanted {
  id        String    @id @default(cuid())
  studentId String
  skillId   String
  student   Student   @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
  skill     Skill     @relation(fields: [skillId], references: [id], onDelete: Cascade)
  requests  Request[]
}

model Request {
  id               String  @id @default(cuid())
  senderId         String
  receiverId       String?
  requestedSkillId String
  offeredSkillId   String

  sender         Student       @relation("RequestSent", fields: [senderId], references: [studentId], onDelete: Cascade)
  receiver       Student?      @relation("RequestReceived", fields: [receiverId], references: [studentId], onDelete: SetNull)
  requestedSkill SkillOffered  @relation(fields: [requestedSkillId], references: [id])
  offeredSkill   SkillWanted   @relation(fields: [offeredSkillId], references: [id])
  status         RequestStatus @default(PENDING)
  createdAt      DateTime      @default(now())
  completedAt    DateTime?

  @@unique([senderId, receiverId, requestedSkillId, offeredSkillId])
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

model Favorite {
  id           String @id @default(cuid())
  studentId    String
  favStudentId String

  student    Student  @relation("Favorites", fields: [studentId], references: [studentId], onDelete: Cascade)
  favStudent Student  @relation("Favorited", fields: [favStudentId], references: [studentId])
  createdAt  DateTime @default(now())
}

model Report {
  id             Int     @id @default(autoincrement())
  reporterId     String
  reportedUserId String
  reason         String
  adminNotes     String?

  reporter     Student  @relation("Reporter", fields: [reporterId], references: [studentId])
  reportedUser Student  @relation("Reported", fields: [reportedUserId], references: [studentId])
  createdAt    DateTime @default(now())

  @@index([reporterId])
  @@index([reportedUserId])
}
